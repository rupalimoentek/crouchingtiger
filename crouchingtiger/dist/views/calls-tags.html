<div id="callscallbackreport" ng-controller="CallsDetailsController"><div id="page-heading"><h1>Call Tags</h1><div class="options"><div class="btn-toolbar"><div class="btn-group" dropdown><button type="button" class="btn btn-default dropdown-toggle">Export as <span class="caret"></span></button><ul class="dropdown-menu" role="menu"><li><a ng-csv="getCSVData()" lazy-load="true" csv-header="csvHeaderNames" filename="csv_calls.csv" onclick="ga('send', 'event', { eventCategory: 'Call Details', eventAction: 'Export', eventLabel: 'Export CSV'});">CSV</a></li><li><a ng-csv="getCSVData()" lazy-load="true" csv-header="csvHeaderNames" filename="csv_calls.tsv" field-separator="\t" onclick="ga('send', 'event', { eventCategory: 'Call Details', eventAction: 'Export', eventLabel: 'Export TSV'});">TSV</a></li><li><a ng-csv="getCSVData()" lazy-load="true" csv-header="csvHeaderNames" filename="exl_calls.xls" onclick="ga('send', 'event', { eventCategory: 'Call Details', eventAction: 'Export', eventLabel: 'Export Excel'});">Excel</a></li><li><a ng-click="exportPDF()" onclick="ga('send', 'event', { eventCategory: 'Call Details', eventAction: 'Export', eventLabel: 'Export PDF'});">PDF</a></li></ul></div><div class="pull-right" style="margin-left:10px;"><button class="btn btn-default ng-isolate-scope" daterangepicker="drp_options" date-begin="drp_start" date-end="drp_end" onapplychange="changeDateRange()"><i class="fa fa-calendar"></i> <span style="margin-left: 5px" class="ng-binding">{{drp_start +' - '+ drp_end}}</span> <b class="caret"></b></button></div></div></div></div><style>.subscript {position: relative;font-size: 18px;top: 0px;color: rgba(255, 255, 255, 0.6);}</style><div class="container-fluid" id="callsData"><div class="container-fluid pb0"><div class="row" ng-repeat="summary in summaryitems"><div class="col-xs-6 col-sm-4 col-md-4 col-lg-2 chartizzle"><tile type="midnightblue"><tile-heading>Total Calls</tile-heading><div class="text-center">{{summary.total_count_calls || '0'}}</div></tile></div><div class="col-xs-6 col-sm-4 col-md-4 col-lg-2 chartizzle"><tile type="midnightblue"><tile-heading>Answered Calls</tile-heading><div class="text-center">{{summary.total_answered_calls || '0'}}</div></tile></div><div class="col-xs-6 col-sm-4 col-md-4 col-lg-2 chartizzle"><tile type="midnightblue"><tile-heading>Unanswered Calls</tile-heading><div class="text-center">{{summary.total_unanswered_calls || '0'}}</div></tile></div><div class="col-xs-6 col-sm-4 col-md-4 col-lg-2 chartizzle"><tile type="midnightblue"><tile-heading>Busy Calls</tile-heading><div class="text-center">{{summary.total_busy_calls || '0'}}</div></tile></div><div class="col-xs-6 col-sm-4 col-md-4 col-lg-2 chartizzle"><tile type="midnightblue"><tile-heading>Unique Calls</tile-heading><div class="text-center">{{summary.total_unique_calls || '0'}}</div></tile></div><div class="col-xs-6 col-sm-4 col-md-4 col-lg-2 chartizzle"><tile type="midnightblue"><tile-heading>Avg. Duration</tile-heading><div class="text-center">{{summary.average_durationMM || '0'}}<span class="subscript">min</span>{{summary.average_durationSS || '0'}}<span class="subscript">sec</span></div></tile></div></div></div><style>.dc-chart{float:none;}
    	span.handle{display:none;}
    	.chartizzle .panel-heading h4{font-size:11px;}
    	.advancedf{background:#efefef; border: 1px solid #ccc;  border-radius: 5px;  overflow: auto;  padding: 15px 0 15px 15px;
      -moz-border-radius: 5px;  -webkit-border-top-left-radius: 5px;  -webkit-border-top-right-radius: 5px;  -webkit-border-bottom-left-radius: 5px;
      -webkit-border-bottom-right-radius: 5px;}
      ._GATq {  border-left: 1px solid #ccc;  border-right: 1px solid #ccc;  clear: both;  position: relative;  text-align: center;  margin: -1px 0;}
      ._GATq._GAQzb {  background-color: #efefef;  color: #575757;  font-size: 1.2em;  font-weight: bold;  margin-left: 80px;  padding: 5px 0;  width: 80px;}
	  #listen_workspace tab-heading .badge{top:-6px !important;left:7px !important;}
	  .tab-container p{min-width:150px;}</style><div class="container-fluid pb0" style="padding:0 20px;"><div class="row"><div class="panel panel-inverse"><div class="panel-heading"><h4>Call Details</h4><panel-controls><a href=""><panel-control-collapse class="fa fa-chevron-down"></panel-control-collapse></a></panel-controls></div><div class="panel-body"><div class="col-md-3 col-lg-2 mb10" ng-show="summaryitems[0].total_count_calls > 0">Showing {{pagination.current > 1 ? ((pageSize * (pagination.current -1)) + 1) : pagination.current }} - {{ (pageSize * pagination.current) > summaryitems[0].total_count_calls ? summaryitems[0].total_count_calls : (pageSize * pagination.current) }} of {{summaryitems[0].total_count_calls || '0'}}</div><div class="col-md-offset-1 col-lg-offset-4 col-md-5 col-lg-4 input-icon right mb20"><div class="input-group"><input type="text" ng-model="simpleSearchFilter" id="simpleChart" class="form-control" placeholder="{{simpleSearchPlaceholder || 'Basic Search'}}" ng-readonly="advFilter" ng-change="validateSimpleTextFilter(simpleSearchFilter)"> <span class="input-group-btn"><button type="button" class="btn btn-primary" ng-click="applySimpleFilter()"><i class="fa fa-search" title="Search"></i></button> <button type="button" class="btn btn-primary" ng-click="resetFilters()" ng-disabled="advFilter"><i class="fa fa-times-circle" title="Clear"></i></button></span></div></div><div class="col-md-3 col-lg-2 mb20 text-right"><button class="btn btn-midnightblue-alt btn-block" ng-click="advFilter = true; simpleSearchFilter=''; simpleSearchPlaceholder='Basic Search Disabled'" onclick="ga('send', 'event', { eventCategory: 'Call Details', eventAction: 'Toggle', eventLabel: 'Toggle Advanced Filter'});">Advanced filter</button></div><div ng-class="{'col-md-12 mt20 mb20' : advFilter, 'hide' : !advFilter}"><div ng-repeat="af in advFilterDefinitions"><div class="advancedf"><select style="width:auto;display:inline;" class="form-control" ng-model="af.inclusivity" ng-init="af.inclusivity = advancedFilterConfig.inclusivity[0].label"><option ng-repeat="inc in advancedFilterConfig.inclusivity" value="{{ inc.label }}">{{ inc.val }}</option></select> <select style="width:auto;display:inline;" class="form-control" ng-model="af.column" ng-init="af.column = advancedFilterConfig.columns[0].label"><option ng-repeat="col in advancedFilterConfig.columns" value="{{ col.label }}">{{ col.val }}</option></select> <select style="width:auto;display:inline;" class="form-control" ng-model="af.comparativeOperator" ng-init="af.comparativeOperator = advancedFilterConfig.comparitiveOperators[0].label"><option ng-repeat="co in advancedFilterConfig.comparitiveOperators" value="{{ co.label }}">{{ co.val }}</option></select> <input style="width:150px;display:inline;" type="text" class="form-control" placeholder="required" ng-model="af.text"> <a title="Delete" ng-click="advFilterDefinitions.length > advancedFilterConfig.minQuantity ? advFilterDefinitions.splice($index, 1) : null" ng-hide="$index == 0 && advFilterDefinitions.length == 1"><i class="fa fa-times-circle"></i></a></div><div class="_GATq _GAQzb">and</div></div><div class="advancedf"><button class="btn btn-gray" style="border:1px dashed #575757;" onclick="ga('send', 'event', { eventCategory: 'Call Details', eventAction: 'Add', eventLabel: 'Add Advanced Filter'});" ng-click="advFilterDefinitions.length < advancedFilterConfig.maxQuantity ? advFilterDefinitions.push( createAdvFiltDefinition() ) : null"><i class="fa fa-plus-circle"></i> Add an Advanced Filter</button></div><hr><div class="clearfix text-right"><button class="btn btn-primary" onclick="ga('send', 'event', { eventCategory: 'Call Details', eventAction: 'Apply', eventLabel: 'Advanced Filter'});" ng-click="applyAdvancedFiltersToDataGrid()">Apply</button> <button class="btn btn-default" onclick="ga('send', 'event', { eventCategory: 'Call Back', eventAction: 'Cancel', eventLabel: 'Advanced Filter'});" ng-click="resetFilters()">Cancel</button></div></div><div id="cdr_table" style="" class="table-responsive" ng-class="{'col-md-12' : infoArea, 'col-md-12' : !infoArea}"><table class="table table-striped table-hover table-condensed table-responsive" id="callbackstable"><thead><tr><th>Date/Time</th><th>Campaign</th><th>Channel</th><th>Caller ID</th><th>Tracking No.</th><th>Destination Name | No.</th><th>Duration</th><th class="text-right">Actions</th></tr></thead><tbody ng-init="showme = []"><tr ng-class="{'active' : item.showinfo, 'inactive' : !item.showinfo}" dir-paginate-start="item in items | itemsPerPage: pageSize" total-items="summaryitems[0].total_count_calls" current-page="pagination.current"><td class="date">{{ item.call_start_date || '' }}</td><td class="campaign">{{ item.campaign_name || '' }}</td><td class="category">{{ item.category + ":" + item.sub_category || '' }}</td><td class="source">{{ item.source || '' }}</td><td class="tracking">{{ item.tracking || '' }}</td><td class="ringto">{{ (item.ring_to_name !== null) ? item.ring_to_name : item.ring_to || '' }}</td><td class="duration">{{ item.durationHHMMSS || '' }}</td><td style="white-space: nowrap"><div class="buttons text-right"><button class="btn btn-sm btn-primary" ng-disabled="{{ item.noRecording }}" ng-click="showme[$index]=true; playvoiceaudio($index, item.s3URL, 'play')" ng-hide="showme[$index]" title="{{ item.listenLabel }}">Listen</button><div class="btn-group ng-hide" ng-show="showme[$index]"><button type="button" class="btn btn-sm btn-primary" ng-click="showme[$index]=true; playvoiceaudio($index, item.s3URL, 'rewind')"><i class="fa fa-backward"></i></button> <button type="button" class="btn btn-sm btn-primary" ng-click="showme[$index]=false; playvoiceaudio($index, item.s3URL, 'pause')"><i class="fa fa-pause"></i></button> <button type="button" class="btn btn-sm btn-primary" ng-click="showme[$index]=true; playvoiceaudio($index, item.s3URL, 'forward')"><i class="fa fa-forward"></i></button></div><button class="btn btn-sm btn-info" data-toggle="collapse" data-target="#{{ item.call_id }}" class="accordion-toggle" ng-click="item.showinfo = !item.showinfo; getinfodetails($index, item.call_id, item.showinfo)">Info</button> <button class="btn btn-sm btn-danger" ng-disabled="isReadonly" ng-click="item.blockme=true; blocknumber($index, item.source);" ng-hide="item.blockme">{{item.blocktext}}</button> <button class="btn btn-sm btn-danger ng-hide" ng-disabled="isReadonly" ng-show="item.blockme"><i class="fa fa-spinner fa-spin"></i></button> <button class="btn btn-default btn-sm" ng-click="openEmail('lg', item.s3URL);" ng-disabled="item.noRecording"><i class="fa fa-envelope-o"></i></button></div></td></tr><tr dir-paginate-end><td colspan="12" class="hiddenRow"><div class="accordian-body collapse mt10" id="{{ item.call_id }}"><tabset tab-theme="info" tab-position="right"><tab><tab-heading><span class="">Info</span></tab-heading><div class="col-lg-6 col-md-6 col-sm-6"><div class="col-lg-6"><p><strong>Name and Address</strong><br>{{ caller_info.consumer1.first_name || '' }} {{ caller_info.consumer1.last_name || '' }}<br>{{ caller_info.address_info.house_number || '' }} {{ caller_info.address_info.street_name || '' }}<br>{{ caller_info.address_info.city || '' }}, {{ caller_info.address_info.state || '' }} {{ caller_info.address_info.zip || '' }}</p></div><div class="col-lg-6"><p><strong>Conversation</strong><br>Sales Inquiry: {{ (parseInt(ind_scores[0].score_value) > 50) ? 'True' : 'False' || '' }}<br>Lead Score: {{ ind_scores[1].score_value || '' }}<br>Conversion: {{ (parseInt(ind_scores[2].score_value) > 50) ? 'True' : 'False' || '' }}<br>Missed Opportunity:</p></div></div><div class="col-lg-6 col-md-6 col-sm-6"><div class="col-lg-6"><p><strong>Session</strong><br>Referring: {{ dnidata.referring || '' }} {{ dnidata.referring_type || '' }}<br>Keyword: {{ dnidata.search_words || '' }}<br>utm_campaign: fall2021<br></p></div><div class="col-lg-6"><p><span class="hidden-md hidden-sm hidden-xs"><br></span>First Page: {{ dnidata.first_page || '' }}<br>Last Page: {{ dnidata.last_page || '' }}<br>Geo IP: {{ dnidata.ip_host || '' }}</p></div></div></tab><tab><tab-heading class="dropdown"><span class="">Comments</span> <span class="badge badge-orange">{{call_commentslength[item.call_id] || ''}}</span></tab-heading><div id="comments" class="top2 dashboard bordered"><div class="rt-block widget"><div class="rt-module-inner"><div class="module-content widget-padding widget-container"><form name="commentForm" id="commentForm" valid-submit="postcomment($index, item.call_id);" novalidate><fieldset><div class=""><label class="control-label">Comment:</label> <input class="btn btn-info btn-sm pull-right update" type="submit" id="addComment{{item.call_id}}" title="Add Comment Button" ng-disabled="!comment.text[item.call_id]" value="Add"> <textarea name="commenttext" title="Add Comment" class="mt10 form-control" style="resize:vertical;" id="comment.text{{item.call_id}}" ng-model="comment.text[item.call_id]"></textarea></div></fieldset></form><div id="comments_container" class="mt10" ng-repeat="call_comment in call_comments[item.call_id]"><div id="commentblock_{{call_comment.comment_id}}" class="rt-block comment_div"><div><a href=""><img src="/img/icons/icon-delete.png" ng-click="deletecomment($index, call_comment.comment_id,item.call_id);" class="deleteComment" title="Delete comment button:" width="10px" height="10px"></a><strong>{{ call_comment.comment_text || '' }}</strong><br><em>{{call_comment.first_name}}&nbsp;{{call_comment.last_name}}</em><br><em>{{ call_comment.comment_created_formatted || '' }}</em><br><input type="hidden" name="comment_user_id" id="comment_{{call_comment.comment_id}}" value="{{call_comment.comment_id}}"></div></div></div></div></div></div></div></tab><tab><tab-heading class="dropdown"><span class="">Tags</span> <span class="badge badge-orange">{{call_tagslength[item.call_id] || ''}}</span></tab-heading><div id="tags_add" class="top2 dashboard bordered"><div class="module-content widget-padding widget-container"><form name="calltagForm" id="calltagForm" valid-submit="postcalltag($index, item.call_id, true);" novalidate><fieldset><div class=""><label class="control-label">Select Tags:</label> <input class="btn btn-info btn-sm pull-right update" type="submit" id="addCallTag" ng-disabled="!isTagAccess" title="Save Call Tag Button" value="Save"> <select id="calltagselect" class="mb15 mt10" ui-select2="tagoptiontemplate(0)" ng-model="selCallTags[item.call_id]" multiple="multiple" style="width:100%;" ng-disabled="!isTagAccess"><option value="{{call_tag.tag_id}}" locked="{{call_tag.locked}}" ng-repeat="call_tag in call_tags[item.call_id]">{{call_tag.tag_name}}</option><option ng-disabled="true" ng-selected="true" value="">-- Available Tags--</option><option value="{{tag.tag_id}}" ng-repeat="tag in tags">{{tag.tag_name}}</option></select></div></fieldset></form></div></div></tab></tabset></div></td></tr></tbody></table></div></div><div class="panel-footer text-right"><dir-pagination-controls on-page-change="pageChanged(newPageNumber)"></dir-pagination-controls></div></div></div></div></div></div>